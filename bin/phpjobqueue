#! /bin/sh
 
NAME=phpjobqueue
DESC="PHP Jobqueue"
PIDFILE="/var/run/${NAME}.pid"
LOGFILE="/var/log/${NAME}.log" 
DAEMON="/usr/bin/php"
DAEMON_PATH="/opt/phpjobqueue/src"
DAEMON_ARGS="PHPJobQueue/JobQueue.php -m -c jobqueue.conf"
 
START_OPTS="--start --make-pidfile --pidfile ${PIDFILE} --exec ${DAEMON} -- ${DAEMON_ARGS}"
STOP_OPTS="--stop --pidfile ${PIDFILE}"
RESTART_OPTS="--stop -s HUP --pidfile ${PIDFILE}"

test -x $DAEMON || exit 0
set -e

case "$1" in
	start)
		echo -n "Starting ${DESC}: "
		pwd
		start-stop-daemon --chdir $DAEMON_PATH $START_OPTS >> $LOGFILE
		echo "$NAME."
		;;
	stop)
		echo -n "Stopping $DESC: "
		start-stop-daemon $STOP_OPTS
		echo "$NAME."
		rm -f $PIDFILE
		;;
	restart|force-reload)
		echo -n "Restarting $DESC: "
		start-stop-daemon $RESTART_OPTS >> $LOGFILE
		#sleep 1
		#start-stop-daemon $START_OPTS >> $LOGFILE
		echo "$NAME."
		;;
	*)
		N=/etc/init.d/$NAME
		echo "Usage: $N {start|stop|restart|force-reload}" >&2
		exit 1
		;;
esac
exit 0
